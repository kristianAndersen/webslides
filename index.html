<!DOCTYPE html>
<html>
<head>
    <title>Web Slideshow Sender</title>
    <meta name="google-site-verification" content="_XvmZoCUOo_pqbKc2pqZSsQQZXhUm73PJl0CU0o-hDU" />
    <!-- Load the Cast APIs -->
    <script type="text/javascript" src="//www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .url-list {
            margin: 20px 0;
        }
        .url-input {
            display: flex;
            margin-bottom: 10px;
            gap: 10px;
        }
        .url-input input {
            flex-grow: 1;
            padding: 8px;
        }
        button {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
        }
        .controls {
            margin-top: 20px;
        }
        #castStatus {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        google-cast-launcher {
    display: block;
    margin: 20px;
}
    </style>
</head>
<body>
    <h1>Web Slideshow Sender</h1>
    <div id="castStatus">Cast status: Not connected</div>
    
    <div class="url-list" id="urlList">
        <div class="url-input">
            <input type="text" placeholder="Enter URL (e.g., https://example.com)">
            <button onclick="removeUrl(this)">Remove</button>
        </div>
    </div>

    <button onclick="addUrlInput()">Add URL</button>

    <div class="controls">
        <label>
            Display time per page (seconds):
            <input type="number" id="displayTime" value="5" min="1" max="300">
        </label>
        <button id="startCast" onclick="startCasting()" disabled>Start Casting</button>
        <button id="stopCast" onclick="stopCasting()" disabled>Stop Casting</button>
    </div>

    <script>
        const APPLICATION_ID = 'CC1AD845';
        let castSession = null;


        function initializeCastApi() {
    try {
        // Initialize cast loader
        window['__onGCastApiAvailable'] = function(isAvailable) {
            if (isAvailable) {
                try {
                    // Initialize Cast context
                    cast.framework.CastContext.getInstance().setOptions({
                        receiverApplicationId: APPLICATION_ID,
                        autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
                    });

                    // Add Cast button
                        // Create cast button using cast.framework
                        const castButton = document.createElement('button');
                    castButton.className = 'cast-button';
                    castButton.onclick = () => {
                        const context = cast.framework.CastContext.getInstance();
                        if (context.getCastState() !== cast.framework.CastState.CONNECTED) {
                            context.requestSession();
                        }
                    };
                    document.body.insertBefore(castButton, document.body.firstChild);


                    // Add event listeners
                    cast.framework.CastContext.getInstance().addEventListener(
                        cast.framework.CastContextEventType.CAST_STATE_CHANGED,
                        function(event) {
                            console.log('Cast state:', event.castState);
                            handleSessionStateChange(event)
                        }
                    );
                        
                    cast.framework.CastContext.getInstance().addEventListener(
                        cast.framework.CastContextEventType.SESSION_STATE_CHANGED,
                        handleSessionStateChange
                    );

                    console.log('Cast API successfully initialized');
                } catch (e) {
                    console.error('Error during Cast initialization:', e);
                }
            }
        };
    } catch (e) {
        console.error('Error setting up Cast API:', e);
    }
}

function handleSessionStateChange(event) {
    console.log('Event:', event);

    console.log('Session state:', event.sessionState);
    const session = cast.framework.CastContext.getInstance().getCurrentSession();
    const startButton = document.getElementById('startCast');
    const stopButton = document.getElementById('stopCast');

 
    
    startButton.disabled = false;
    stopButton.disabled = false;

    switch(event.sessionState) {
        case cast.framework.SessionState.NO_SESSION:
            console.log('No session');
           
            break;
        case cast.framework.SessionState.CONNECTED:
            console.log('Connected!');
            castSession = session;
        
            break;
        case cast.framework.SessionState.CONNECTING:
            console.log('Connecting...');
            
            break;
    }
}

        function addUrlInput() {
            const urlList = document.getElementById('urlList');
            const urlInput = document.createElement('div');
            urlInput.className = 'url-input';
            urlInput.innerHTML = `
                <input type="text" placeholder="Enter URL (e.g., https://example.com)">
                <button onclick="removeUrl(this)">Remove</button>
            `;
            urlList.appendChild(urlInput);
        }

        function removeUrl(button) {
            button.parentElement.remove();
        }

        function getUrls() {
            const inputs = document.querySelectorAll('.url-input input');
            return Array.from(inputs)
                .map(input => input.value.trim())
                .filter(url => url !== '');
        }

        function startCasting() {
            const urls = getUrls();
            if (urls.length === 0) {
                alert('Please add at least one URL');
                return;
            }

            const displayTimeSeconds = document.getElementById('displayTime').value;
            const displayTimeMs = displayTimeSeconds * 1000;

            if (castSession) {
                console.log('Casting to existing session');
                castSession.sendMessage('urn:x-cast:com.webslideshow', {
                    urls: urls,
                    displayTime: displayTimeMs
                });
            }else{
                console.log('buu');
            }
        }

        function stopCasting() {
            if (castSession) {
                castSession.endSession(true);
            }
        }


        // Make sure the Cast SDK is loaded properly
window.onload = function() {
    // Check if the Cast SDK script is loaded
    const castScript = document.querySelector('script[src*="cast_sender.js"]');
    if (!castScript) {
        const script = document.createElement('script');
        script.src = 'https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1';
        script.async = true;
        document.head.appendChild(script);
    }
    
    initializeCastApi();
};


    </script>
</body>
</html>